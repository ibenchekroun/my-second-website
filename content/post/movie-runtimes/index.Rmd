---
title: "Are movies getting longer?"
author: "Ismail Benchekroun"
date: '2024-10-29'
output:
  html_document: default
  pdf_document: default
always_allow_html: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(DT)
library(xtable)
# library(flextable)
library(magrittr)
library(knitr)
library(kableExtra)
library(plotly)
knitr::opts_chunk$set(echo = TRUE)
data <- readRDS("movies_getting_longer_data.RDS")
```

<!-- ```{r} -->
<!-- data %>% -->
<!--   filter(Title %>% str_detect("When Harry Met Sally|10 Things |Forgetting Sarah |You've Got Mail|Pretty Woman|Crazy, Stupid|13 Going on |40 Year|Knocked Up|Crazy Rich|Notting Hill|Five-Year|Something About Mary|Clueless|Bridget Jones's Diary|Along Came Polly|Wedding Singer|Moonstruck")) %>% -->
<!--   select(Title_Year, IMDB_rating, Metascore_rating) %>% View() -->

<!-- data %>%  -->
<!--   filter(Actors %>% str_detect("Nicolas Cage"), Genres %>% str_detect("Comedy"), Genres %>% str_detect("Romance"))%>% -->
<!--   select(Title_Year, IMDB_rating, Metascore_rating, Genres) %>% View() -->
<!-- ``` -->

<!-- ## UTILS -->
```{r, include = FALSE, echo = FALSE}
  filter_by_actors <- function(reactive_data, input_actors){
    filtered <- reactive_data
    if(!("All" %in% input_actors)){
      filtered <- filtered %>% filter(Actors %>% str_detect(paste0("(?=.*", paste(input_actors, collapse = ")(?=.*"), ")")))
    }
    filtered
  }  
  filter_by_actors_or <- function(reactive_data, input_actors){
    filtered <- reactive_data
    if(!("All" %in% input_actors)){
      filtered <- filtered %>% filter(Actors %>% str_detect(paste(input_actors, collapse = "|")))
    }
    filtered
  }  
  filter_by_writers <- function(reactive_data, input_writers){
    filtered <- reactive_data
    if(!("All" %in% input_writers)){
      filtered <- filtered %>% filter(Writers %>% str_detect(paste0("(?=.*", paste(input_writers, collapse = ")(?=.*"), ")")))
    }
    filtered
  }  
  filter_by_writers_or <- function(reactive_data, input_writers){
    filtered <- reactive_data
    if(!("All" %in% input_writers)){
      filtered <- filtered %>% filter(Writers %>% str_detect(paste(input_writers, collapse = "|")))
    }
    filtered
  }  
  filter_by_directors <- function(reactive_data, input_directors){
    filtered <- reactive_data
    if(!("All" %in% input_directors)){
      filtered <- filtered %>% filter(Directors %>% str_detect(paste0("(?=.*", paste(input_directors, collapse = ")(?=.*"), ")")))
    }
    filtered
  }  
  filter_by_directors_or <- function(reactive_data, input_directors){
    filtered <- reactive_data
    if(!("All" %in% input_directors)){
      filtered <- filtered %>% filter(Directors %>% str_detect(paste(input_directors, collapse = "|")))
    }
    filtered
  }
  adding_top50 <- function(reactive_data, input_top50){
    filtered <- reactive_data
    if(input_top50 == "Budget"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-Budget_2020_usd_numeric)) %>%
        filter(rank_col <= 50) %>% ungroup()
    }else if(input_top50 == "Gross"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-Gross_US_Can_numeric)) %>%
        filter(rank_col <= 50) %>% ungroup()
    }else if(input_top50 == "IMDb raters"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-IMDB_raters_count)) %>%
        filter(rank_col <= 50) %>% ungroup()
    }else if(input_top50 == "IMDb ratings"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-as.numeric(IMDB_rating))) %>%
        filter(rank_col <= 50) %>% ungroup()
    }else if(input_top50 == "Metascore ratings"){
      filtered <-  filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-as.numeric(Metascore_rating))) %>%
        filter(rank_col <= 50) %>% ungroup()
    }else{
      filtered <- filtered
    }
    filtered
  }
    adding_nextX <- function(reactive_data, input_top_type, input_from, input_to){
    filtered <- reactive_data
    if(input_top_type == "Budget"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-Budget_2020_usd_numeric, ties.method = "random")) %>%
        filter(rank_col >= input_from, rank_col <= input_to) %>% ungroup()
    }else if(input_top_type == "Gross"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-Gross_US_Can_numeric, ties.method = "random")) %>%
        filter(rank_col >= input_from, rank_col <= input_to) %>% ungroup()
    }else if(input_top_type == "IMDb raters"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-IMDB_raters_count, ties.method = "random")) %>%
        filter(rank_col >= input_from, rank_col <= input_to) %>% ungroup()
    }else if(input_top_type == "IMDb ratings"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-as.numeric(IMDB_rating), ties.method = "random")) %>%
        filter(rank_col > 50, rank_col <= 100) %>% ungroup()
    }else if(input_top_type == "Metascore ratings"){
      filtered <-  filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-as.numeric(Metascore_rating), ties.method = "random")) %>%
        filter(rank_col >= input_from, rank_col <= input_to) %>% ungroup()
    }else{
      filtered <- filtered
    }
    filtered
    }
    adding_topX <- function(reactive_data, input_top50, top_from, top_to){
    filtered <- reactive_data
    if(input_top50 == "Budget"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-Budget_2020_usd_numeric, ties.method = "random")) %>%
        filter(rank_col <= top_to, rank_col >= top_from) %>% ungroup()
    }else if(input_top50 == "Gross"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-Gross_US_Can_numeric, ties.method = "random")) %>%
        filter(rank_col <= top_to, rank_col >= top_from) %>% ungroup()
    }else if(input_top50 == "IMDb raters"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-IMDB_raters_count, ties.method = "random")) %>%
        filter(rank_col <= top_to, rank_col >= top_from) %>% ungroup()
    }else if(input_top50 == "IMDb ratings"){
      filtered <- filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-as.numeric(IMDB_rating), ties.method = "random")) %>%
        filter(rank_col <= top_to, rank_col >= top_from) %>% ungroup()
    }else if(input_top50 == "Metascore ratings"){
      filtered <-  filtered %>%
        group_by(Year) %>% 
        mutate(rank_col = rank(-as.numeric(Metascore_rating), ties.method = "random")) %>%
        filter(rank_col <= top_to, rank_col >= top_from) %>% ungroup()
    }else{
      filtered <- filtered
    }
    filtered
  }
  filter_by_genres <- function(reactive_data, input_genres){
    filtered <- reactive_data
    if(!("All" %in% input_genres)){
      filtered <- filtered %>% filter(Genres %>% str_detect(paste0("(?=.*", paste(input_genres, collapse = ")(?=.*"), ")")))
    }
    filtered
  }
  filter_by_genres_nr <- function(reactive_data, input_genres){
    filtered <- reactive_data
    if(!("All" %in% input_genres)){
      filtered <- filtered %>% filter(Genres %>% str_detect(paste(input_genres, collapse = "|")))
    }
    filtered
  }
  filter_by_pc <- function(reactive_data, input_pc){
    filtered <- reactive_data
    if(!("All" %in% input_pc)){
      filtered <- filtered %>% filter(Production_companies %>% str_detect(paste0(input_pc, collapse = "|")))
    }
    filtered
  }
  filter_by_pc_nr <- function(reactive_data, input_pc){
    filtered <- reactive_data
    if(!("All" %in% input_pc)){
      filtered <- filtered %>% filter(Production_companies %>% str_detect(paste0(input_pc, collapse = "|")))
    }
    filtered
  }
  filter_by_bp <- function(reactive_data, input_bp){
    filtered <- reactive_data
    if(input_bp == "Winners"){
      filtered <- filtered %>% filter(BP_Award_status == "Won")
    }else if(input_bp == "Nominees"){
      filtered <- filtered %>% filter(BP_Award_status == "Nominated" | BP_Award_status == "Won")
    } else {
      filtered <- filtered
    }
    filtered
  }
  filter_by_os <- function(reactive_data, input_os){
    filtered <- reactive_data
    if(input_os == "Winners"){
      filtered <- filtered %>% filter(OS_Award_status == "Won")
    }else if(input_os == "Nominees"){
      filtered <- filtered %>% filter(OS_Award_status == "Nominated" | OS_Award_status == "Won")
    } else {
      filtered <- filtered
    }
    filtered
  }
```

<!-- ## DEFINING BEFORE AND AFTER -->
```{r, include = FALSE, echo = FALSE}

    

filter_data_ba_fn <- function(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba = 1,
    top_to_ba = 50,
    exclude_years_ba,
    exclude_genres_ba){
    
  if(before_year1 == before_year2){
    before_years_str <- paste0("Before (", as.character(before_year1), ")")
  }else{
    before_years_str <- paste0("Before (", as.character(before_year1), "-", as.character(before_year2), ")")
  }
   if(after_year1 == after_year2){
    after_years_str <- paste0("After (", as.character(after_year1), ")")
  }else{
    after_years_str <- paste0("After (", as.character(after_year1), "-", as.character(after_year2), ")")
  }


inbetween_str <- paste0("In-Between (", as.character(before_year2+1), "-", as.character(after_year1 - 1), ")")

    filtered <- data[data$Year_numeric >= before_year1 & data$Year_numeric <= after_year2, ]

    filtered$Group <- with(filtered, ifelse(Year_numeric <= before_year2, before_years_str,
                                            ifelse(Year_numeric < after_year1, inbetween_str, after_years_str)))
    filtered$Group <- factor(filtered$Group, levels=c(before_years_str, after_years_str, inbetween_str))

    filtered <- filtered[filtered$IMDB_raters_count > ratings_threshold_ba, ]
    # filtered <- filtered[filtered$Budget_2020_usd_numeric >= budget_threshold_g & !is.na(filtered$Budget_2020_usd_numeric), ]

    filtered <- filter_by_bp(filtered, the_bp_oscar_general_ba)
    filtered <- filter_by_os(filtered, the_os_oscar_general_ba)
    filtered <- filter_by_genres_nr(filtered, the_g_general_ba)    
    filtered <- filtered %>% filter(!(Genres %>% str_detect(exclude_genres_ba)))
    filtered <- filter_by_pc_nr(filtered, the_pc_general_ba)
    filtered <- filter_by_actors_or(filtered, the_a_general_ba)
    filtered <- filter_by_writers_or(filtered, the_w_general_ba)
    filtered <- filter_by_directors_or(filtered, the_d_general_ba)
    filtered <- adding_topX(filtered, the_top_50_ba, top_from_ba, top_to_ba)
    filtered <- filtered %>% filter(!(Year_numeric %in% as.numeric(exclude_years_ba)))
    
    filtered
    
}


before_year1 <- 2009
before_year2 <- 2015
after_year1 <- 2016
after_year2 <- 2022



```

<!-- ## DEFINING Group A AND Group B -->
```{r, include = FALSE, echo = FALSE}

    
filter_data_gg_fn <- function(gg_year1,
                           gg_year2,
                           ratings_threshold_gg1, 
                           the_bp_oscar_general_gg1, 
                           the_os_oscar_general_gg1,
                               the_pc_general_gg1,
    the_a_general_gg1, 
    the_w_general_gg1, 
    the_d_general_gg1, 
    the_g_general_gg1, 
    the_top_X_gg1, 
    topX_from_gg1 = 1,
    topX_to_gg1 = 50,
    exclude_years_gg1,
        exclude_genres_gg1, 
    descriptor_A,
    ratings_threshold_gg2, 
                           the_bp_oscar_general_gg2, 
                           the_os_oscar_general_gg2,
                               the_pc_general_gg2,
    the_a_general_gg2, 
    the_w_general_gg2, 
    the_d_general_gg2, 
    the_g_general_gg2, 
    the_top_X_gg2, 
    topX_from_gg2 = 1,
    topX_to_gg2 = 50,
    exclude_years_gg2,
    exclude_genres_gg2,
    descriptor_B){
    
filtered <- data[data$Year_numeric >= gg_year1 & data$Year_numeric <= gg_year2, ]
    groupA_str <- paste0("Group A (", 
                         descriptor_A,
                         ")")
    groupB_str <- paste0("Group B (", 
                         descriptor_B,
                         ")")    
    filtered_gg1 <- filtered
    filtered_gg2 <- filtered
    filtered_gg1 <- filtered_gg1[filtered_gg1$IMDB_raters_count > ratings_threshold_gg1, ]
    # filtered_gg1 <- filtered_gg1[filtered_gg1$Budget_2020_usd_numeric >= budget_threshold_g & !is.na(filtered_gg1$Budget_2020_usd_numeric), ]
    filtered_gg1 <- filter_by_bp(filtered_gg1, the_bp_oscar_general_gg1)
    filtered_gg1 <- filter_by_os(filtered_gg1, the_os_oscar_general_gg1)
    filtered_gg1 <- filter_by_genres(filtered_gg1, the_g_general_gg1)    
    filtered_gg1 <- filtered_gg1 %>% filter(!(Genres %>% str_detect(exclude_genres_gg1)))
    filtered_gg1 <- filter_by_pc_nr(filtered_gg1, the_pc_general_gg1)
    print(the_a_general_gg1)
    filtered_gg1 <- filter_by_actors_or(filtered_gg1, the_a_general_gg1)
    print(the_w_general_gg1)
    filtered_gg1 <- filter_by_writers_or(filtered_gg1, the_w_general_gg1)
    filtered_gg1 <- filter_by_directors_or(filtered_gg1, the_d_general_gg1)
    filtered_gg1 <- adding_topX(filtered_gg1, the_top_X_gg1, topX_from_gg1, topX_to_gg1)
    filtered_gg1 <- filtered_gg1 %>% filter(!(Year_numeric %in% as.numeric(exclude_years_gg1)))
    filtered_gg1 <- filtered_gg1 %>% mutate(Group = groupA_str)
    
    print(filtered_gg1 %>% select(Title_Year, Group))
    filtered_gg2 <- filtered_gg2[filtered_gg2$IMDB_raters_count > ratings_threshold_gg2, ]
    # filtered__gg2 <- filtered__gg2[filtered__gg2$Budget_2020_usd_numeric >= budget_threshold_g & !is.na(filtered__gg2$Budget_2020_usd_numeric), ]
    filtered_gg2 <- filter_by_bp(filtered_gg2, the_bp_oscar_general_gg2)
    filtered_gg2 <- filter_by_os(filtered_gg2, the_os_oscar_general_gg2)
    filtered_gg2 <- filter_by_genres(filtered_gg2, the_g_general_gg2)    
    filtered_gg2 <- filtered_gg2 %>% filter(!(Genres %>% str_detect(exclude_genres_gg2)))
    filtered_gg2 <- filter_by_pc_nr(filtered_gg2, the_pc_general_gg2)
    filtered_gg2 <- filter_by_actors_or(filtered_gg2, the_a_general_gg2)
    print(the_a_general_gg1)
    print(the_w_general_gg2)
    filtered_gg2 <- filter_by_writers_or(filtered_gg2, the_w_general_gg2)
    filtered_gg2 <- filter_by_directors_or(filtered_gg2, the_d_general_gg2)
    filtered_gg2 <- adding_topX(filtered_gg2, the_top_X_gg2, topX_from_gg2, topX_to_gg2)
    filtered_gg2 <- filtered_gg2 %>% filter(!(Year_numeric %in% as.numeric(exclude_years_gg2)))    
    filtered_gg2 <- filtered_gg2 %>% mutate(Group = groupB_str)
    
    print(filtered_gg1 %>% select(Title_Year, Group))
  
    filtered_both <- filtered_gg1 %>% bind_rows(filtered_gg2)
    print(filtered_both$Group %>% table())
    filtered_both$Group <- as.factor(filtered_both$Group)
    filtered_both
}



```

```{r, echo = FALSE, include = FALSE}
get_chisq_genres <- function(dataset_name, genre_percentage_ba, exclude_genre_percentage_ba){
    # df <- filter_by_genres(filtered_data6, genre_percentage_ba_input)
    df <- dataset_name %>%
      mutate(`Movie Type` = ifelse(
        (Genres %>% str_detect(paste0("(?=.*", paste(genre_percentage_ba, collapse = ")(?=.*"), ")"))) &
          !(Genres %>% str_detect(paste0("(?=.*", paste(exclude_genre_percentage_ba, collapse = ")(?=.*"), ")"))), paste(genre_percentage_ba, collapse = ", "), "Other"))
    
 # paste0("(?=.*", paste(genre_percentage_ba, collapse = ")(?=.*"), ")"), "Other"))
    
    print(paste0("(?=.*", paste(genre_percentage_ba, collapse = ")(?=.*"), ")"))
 #%>%
    # group_by(Group, `Movie Type`) %>%
    # summarise(n_movies = n()) 
    group_type_counts <- df %>% group_by(Group, `Movie Type`) %>%
      summarise(type_per_group_n = n())  %>% filter(!(`Movie Type` %>% str_detect("Other")))
    group_counts <- df %>% group_by(Group) %>% 
      summarise(group_n = n())
    # print(group_type_counts)
    # print(group_counts)
    # print(df_counts)
    # chi_pval <- chisq.test(df_counts)$p.value
    # chi_pval_str <- paste0("p-value of chi-square test of independence is ", round(chi_pval, 3))
    # print(chi_pval_str)
    # data.frame("Test Results" = chi_pval_str)
    print("BEFORE PROP TEST")
    pt <- prop.test(x = group_type_counts$type_per_group_n, n = group_counts$group_n,
                    alternative = "greater")
    pt_df <- round(pt$estimate, 2) %>% as.data.frame() %>% t()%>% as.data.frame()  %>% mutate(pval = round(pt$p.value, 3), test = "2-proportion Z-test", `Alt Hypothesis` = "After < Before")
    colnames(pt_df)[1:length(levels(group_counts$Group))][1:2] <- levels(group_counts$Group)[1:2]
    print("AFTER PROP TEST")
    print(pt_df)
    pt_df %>% select(4, 5, 1, 2, 3) %>% rename("p value" = pval)
}

get_chisq_genres_gg <- function(dataset_name, genre_percentage_ba, exclude_genre_percentage_ba){
    # df <- filter_by_genres(filtered_data6, genre_percentage_ba_input)
    df <- dataset_name %>%
      mutate(`Movie Type` = ifelse(
        (Genres %>% str_detect(paste0("(?=.*", paste(genre_percentage_ba, collapse = ")(?=.*"), ")"))) &
          !(Genres %>% str_detect(paste0("(?=.*", paste(exclude_genre_percentage_ba, collapse = ")(?=.*"), ")"))), paste(genre_percentage_ba, collapse = ", "), "Other"))
    
    print(paste0("(?=.*", paste(genre_percentage_ba, collapse = ")(?=.*"), ")"))
 #%>%
    # group_by(Group, `Movie Type`) %>%
    # summarise(n_movies = n()) 
    group_type_counts <- df %>% group_by(Group, `Movie Type`) %>%
      summarise(type_per_group_n = n())  %>% filter(!(`Movie Type` %>% str_detect("Other")))
    group_counts <- df %>% group_by(Group) %>% 
      summarise(group_n = n())
    # print(group_type_counts)
    # print(group_counts)
    # print(df_counts)
    # chi_pval <- chisq.test(df_counts)$p.value
    # chi_pval_str <- paste0("p-value of chi-square test of independence is ", round(chi_pval, 3))
    # print(chi_pval_str)
    # data.frame("Test Results" = chi_pval_str)
    print("BEFORE PROP TEST")
    pt <- prop.test(x = group_type_counts$type_per_group_n, n = group_counts$group_n,
                    alternative = "greater")
    pt_df <- round(pt$estimate, 3) %>% as.data.frame() %>% t()%>% as.data.frame()  %>% mutate(pval = round(pt$p.value, 3), test = "2-proportion Z-test", `Alt Hypothesis` = "Group A > Group B")
    colnames(pt_df)[1:length(levels(group_counts$Group))][1:2] <- levels(group_counts$Group)[1:2]
    print("AFTER PROP TEST")
    print(pt_df)
    pt_df %>% select(4, 5, 1, 2, 3) %>% rename("p value" = pval)
}

get_genres_ba_plot <- function(dataset_name, genre_percentage_ba_input, exclude_genre_percentage_ba_input){
   df <- dataset_name %>%
      mutate(`Movie Type` = ifelse(
        (Genres %>% str_detect(paste0("(?=.*", paste(genre_percentage_ba_input, collapse = ")(?=.*"), ")"))) &
          !(Genres %>% str_detect(paste0("(?=.*", paste(exclude_genre_percentage_ba_input, collapse = ")(?=.*"), ")"))), paste(genre_percentage_ba_input, collapse = ", "), "Other")) %>%
      group_by(Group, `Movie Type`) %>%
      summarise(n_movies = n()) %>%
      ungroup() %>%
      group_by(Group) %>%
      mutate(`Percentage` = round(n_movies / sum(n_movies)*100 , 2)) %>%
      ungroup()   %>% as.data.frame() %>%
      filter(`Movie Type` != "Other")
    print(df)
    df %>%
      ggplot(aes(x = `Movie Type`, y = Percentage, fill = Group)) +
      geom_bar(stat="identity", position=position_dodge())+
      # facet_wrap(~Group) + # To create separate pie charts for each Group
      # coord_polar("y", start = 0) + # Convert bar chart to polar coordinates for a pie chart
      theme_minimal() + # Remove unnecessary elements
      theme(legend.position = "right") +
      labs(x = "Genre", y = "%") +
      ggtitle(paste0("% of movies that are ", paste(genre_percentage_ba_input, collapse = ", "))) +
      scale_fill_manual(values = c("blue4", "darkgoldenrod"))
}

get_aggplot_data <- function(the_data, func){
    agg_data <- the_data %>% 
      arrange(-IMDB_raters_count) %>% 
      group_by(Year_numeric) %>%
      summarise(Runtime_numeric =  round(func(Runtime_numeric)), `Total movies` = n(), Gross_2020 = sum(Gross_2020, na.rm = TRUE)) %>% ungroup()
    
    agg_data <- agg_data %>%
      # fuzzy_left_join(
      left_join(
        the_data %>% select(Year_numeric, Runtime_numeric, Title),
        # by = c("Year_numeric" = "Year_numeric", "Runtime_numeric" = "Runtime_numeric"),
        # match_fun = function(x, y) abs(x - y)) %>%
      ) %>%
      group_by(Year_numeric)%>%
      summarise(agg_Runtime =  round(func(Runtime_numeric)), Titles = paste0(Title, collapse = ", \n"), `Total releases` = mean(`Total movies`), Gross_2020 = mean(Gross_2020)/100000000) %>% ungroup() %>%
      rename(Year = Year_numeric, Runtime = agg_Runtime)
}


get_aggplot_years <- function(the_data, func){
    title_string <- get_string_from_function(func)
    # print(title_string)
    agg_data <- get_aggplot_data(the_data, func)
    func_string <- get_func_name(func)
    p <- agg_data %>%
      ggplot(aes(x = Year)) + 
      geom_line(aes(y = Runtime, col = func_string, label = Titles), show.legend = TRUE, size = 1.5) + 
      labs(col = "Runtime (minutes)") +
      labs(y = "", x = "Year") + 
      ggtitle(paste0(title_string, " Runtime over the years")) +
      geom_col(aes(y = `Total releases`, fill = "Total Releases"), show.legend = TRUE) +
        labs(fill = "Total Releases") +

      scale_x_continuous(breaks = seq(before_year1, after_year2+1, by = 5)) + 
      theme(
        panel.background = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        plot.background = element_blank()#,
        # legend.position = "top"
      ) + 
      # scale_size_continuous(limits = c(1, 1000)) +
      scale_color_manual(values = c( "darkblue"#, "Median Gross (2020 USD)" = "darkgreen"
                                     )) +
      scale_fill_manual(values = c("Total Releases" = "pink")) +
      # scale_fill_manual(values = c()) +
      guides(
        color = guide_legend(title = ""),
        fill = guide_legend(title = "")
      )
    
    # print(p)
    
    list(p, agg_data$Runtime, agg_data$`Total releases`)
    
}

  get_string_from_function <- function(func){
    # func = "min"
    # func_as_stri <- as.character(substitute(func))
    # print(func_as_stri)
    if(identical(func, min)){
      stri <- "Minimum"
    }else if(identical(func, max)){
      stri <- "Maximum"
    }else if(identical(func, mean)){
      stri <- "Average"
    }else if(identical(func, median)){
      stri <- "Median (50th percentile)"
    }
    stri
  }
  
    get_func_from_stri <- function(stri){
    if(stri == "Maximum plot (shows longest movie)"){
      func <- max
    }else if(stri == "Minimum plot (shows shortest movie)"){
      func <- min
    }else if(stri == "Mean plot (shows average movie length)"){
      func <-  mean
    }else if(stri == "Median plot (shows 50th percentile)"){
      func <- median
    } 
    func
    }
      get_func_name <- function(func) {
    function_map <- list(
      median = median,
      min = min,
      max = max,
      mean = mean
      # Add more functions here if needed
    )
       name <- names(function_map)[sapply(function_map, identical, func)]
    
    if (is.null(name)) {
      stop("Unsupported function")
    }
    str <- paste0(capitalize_first(name), " Runtime (minutes)")
    return(str)
      }
        capitalize_first <- function(string) {
    paste(toupper(substring(string, 1, 1)), substring(string, 2), sep = "")
  }
```

```{r, echo = FALSE, include = FALSE}
get_ttest_runtimes <- function(dataset_name){
    dataset_name <- dataset_name %>% filter(!is.na(Runtime_numeric))
    # tt_table <- filtered_data6%>% 
    #   t_test(Runtime_numeric ~ Group, alternative = "less") #%>% as.data.frame()
    # print(tt_table)
    # tt_table
    before_6 <- dataset_name %>% filter(Group %>% str_detect("Before"))
    after_6 <- (dataset_name %>% filter(Group %>% str_detect("After")))
    tt_res = t.test(before_6$Runtime_numeric, after_6$Runtime_numeric,
           alternative = "less")
    print(tt_res)
    tt_res_df <- round(tt_res$estimate, 1) %>% as.data.frame() %>% t()%>% as.data.frame()  %>% mutate(pval = round(tt_res$p.value, 3))
    # tt_res_df <- round(tt_res_df, 4)
    tt_res_df <- tt_res_df %>% mutate(Test = "2-sample t-test", `Alt Hypothesis` = "After > Before")
    print(unique(as.character(before_6$Group), as.character(after_6$Group)))
    colnames(tt_res_df)[1:length(levels(before_6$Group))][1:2] <- levels(before_6$Group)[1:2]    # print(unique(before_6$Group, after_6$Group))
    # print(tt_res_df)
    tt_res_df <- tt_res_df %>% select( 4,5,1, 2, 3) %>% rename("p value" = pval) 
    
    # print(mean(before_6$Runtime_numeric))
    # print(mean(after_6$Runtime_numeric))
    # print(sd(before_6$Runtime_numeric))
    # print(sd(after_6$Runtime_numeric))    
# print(min(dataset_name$Runtime_numeric))
    # print(dataset_name %>% filter(Runtime_numeric == min(dataset_name$Runtime_numeric)))
    tt_res_df 
}

get_ttest_runtimes_gg <- function(dataset_name){
    dataset_name <- dataset_name %>% filter(!is.na(Runtime_numeric))
    # tt_table <- filtered_data6%>% 
    #   t_test(Runtime_numeric ~ Group, alternative = "less") #%>% as.data.frame()
    # print(tt_table)
    # tt_table
    before_6 <- dataset_name %>% filter(Group %>% str_detect("Group A"))
    after_6 <- (dataset_name %>% filter(Group %>% str_detect("Group B")))
    tt_res = t.test(before_6$Runtime_numeric, after_6$Runtime_numeric,
           alternative = "less")
    print(tt_res)
    tt_res_df <- round(tt_res$estimate, 1) %>% as.data.frame() %>% t()%>% as.data.frame()  %>% mutate(pval = round(tt_res$p.value, 3))
    # tt_res_df <- round(tt_res_df, 4)
    tt_res_df <- tt_res_df %>% mutate(Test = "2-sample t-test", `Alt Hypothesis` = "Group B > Group A")
    print(unique(as.character(before_6$Group), as.character(after_6$Group)))
    colnames(tt_res_df)[1:length(levels(before_6$Group)[1:2])] <- levels(before_6$Group)[1:2]    # print(unique(before_6$Group, after_6$Group))
    # print(tt_res_df)
    tt_res_df <- tt_res_df %>% select( 4,5,1, 2, 3) %>% rename("p value" = pval) 

    tt_res_df 
}
# tt_res_df_1a <- get_ttest_runtimes(filtered_data6)%>% as.data.frame() %>% kable()

```
<!-- ## BEFORE VS AFTER  -->
```{r, include = FALSE, echo = FALSE}

    # before <- levels(filtered_data6$Group)[1]
    # before_runtimes <- mean((filtered_data6 %>% filter(Group == before))$Runtime_numeric)
    # after <- levels(filtered_data6$Group)[2]
    # after_runtimes <- mean((filtered_data6 %>% filter(Group == after))$Runtime_numeric)
    # delta <- abs(after_runtimes - before_runtimes)
    # before <- before %>% str_extract("\\d+-\\d+")
    # after <- after %>% str_extract("\\d+-\\d+")
    # 
    # 
    # shorter_longer_str <- ifelse(before_runtimes > after_runtimes,
    #                              "shorter",
    #                              "longer")
    # paste0("Movies with the given characteristics released in ", 
    #        after, 
    #        " are, on average, ", 
    #        round(delta), " minutes ", 
    #        shorter_longer_str, " than movies with the given characteristics released in ", before, ".")
    
    
```

```{r, echo = FALSE, include = FALSE}
ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Gross"
    top_from_ba <- 1
    top_to_ba <- 20
    exclude_years_ba <- 2020
    exclude_genres_ba = "Ignore"
    before_year1 <- 2002
    before_year2 <- 2002
    after_year1 <- 2022
    after_year2 <- 2022
    
    the_top_50_ba <- "Gross"
filtered_data6_gro <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)
      
          the_top_50_ba <- "Budget"
filtered_data6_bud <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)
            
    original_df <- filtered_data6_gro %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
    # pivot_longer(-Group,
    #              names_to = "Metric", 
    #              values_to = "Value")
    transposed_df <- t(original_df %>% filter(Group %>% str_detect("Before|After")))  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group[1:2]
    
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
```

This is a question I've heard asked in the past couple years by friends and foes alike, usually right after they learn the runtime of a particularly long new movie. I never cared for that question. Why would I, when there will always be so many [great](https://www.imdb.com/title/tt0088930/) [shorter](https://www.imdb.com/title/tt1152850/) [films](https://www.imdb.com/title/tt2334649/) out there I have yet to watch? Over time, however, I got sick of hearing people who had never bothered to look for short gems like [Shiva Baby](https://www.imdb.com/title/tt11317142/) (78 minutes) complain that movies were getting longer. Hoping they were wrong, I did some googling to see what others had said on the topic. *Small clarification: I know some people complaining about long movies have seen Shiva Baby, but this post isn't about them.*

### What others had said and why I do not like what they said

Last year, Vanity Fair published [an article](https://www.vanityfair.com/hollywood/2023/07/why-are-movies-sooooo-long-an-investigation) comparing the top twenty US box office-performing movies of 2022 to those of 2002. They found that, on average, the 2022 films were 13 minutes longer than the 2002 films. Maybe those years seem arbitrarily chosen, and the twenty movie sample size is a little small for your taste, but to me the statistic is a nice illustration of how popular movies may have changed over a twenty-year period. To the writer, however, it meant that “moviegoers had to sit through” an additional 13 minutes of screentime, as though people have no say in the movie theater tickets we buy.

On the contrary, the top box office performers are the films people specifically chose to watch over all others. Who knows how long the non-highest grossing films were? They very well might have been shorter! As Table 2 below shows us, the next twenty greatest box office performers (21-40) i) are shorter in runtime than the first twenty, and ii) see a slight decrease in average runtime over the twenty years. If anything, the more valid takeaway is that filmmakers had to produce an additional 13 minutes of footage to keep audiences interested than the other way around. 

```{r, echo = FALSE, include = FALSE}
ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Gross"
    top_from_ba <-21
    top_to_ba <- 40
    exclude_years_ba <- 2020
    exclude_genres_ba = "Ignore"
    before_year1 <- 2002
    before_year2 <- 2002
    after_year1 <- 2022
    after_year2 <- 2022
    
    the_top_50_ba <- "Gross"
filtered_data6_gro <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)
      
          the_top_50_ba <- "Budget"
filtered_data6_bud <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)
            
    original_df <- filtered_data6_gro %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
    # pivot_longer(-Group,
    #              names_to = "Metric", 
    #              values_to = "Value")
    transposed_df <- t(original_df %>% filter(Group %>% str_detect("Before|After")))  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group[1:2]
    
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
```

```{r, echo = FALSE}
#     transposed_df %>% as.data.frame() %>% kable()
# xtable(transposed_df)
kable(transposed_df, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the 21st-40th Highest Grossers of 2002 vs 2022") %>% 
  kableExtra::kable_styling()
```

This passive framing of moviegoers (of us) that accompanies the “movies are getting longer” discourse is what urks me. Even industry insiders are guilty of it, as producer David T. Friendly (Little Miss Sunshine) voiced his frustrations [online](https://puck.news/shorter-movies-please/) over the length of recent Oscar-nominated movies and called for filmmakers to trim their movies. He obviously knows the industry more than I do, but why point to the filmmakers while not asking anything of the Academy members (himself included) who nominated long films over shorter ones (e.g. [Fallen Leaves](https://www.imdb.com/title/tt21027780/), [All of Us Strangers](https://www.imdb.com/title/tt21192142/), [Bottoms](https://www.imdb.com/title/tt17527468/), etc.)? Asking for longer movies to be shortened when we are not even watching or rewarding the shorter ones feels hypocritical, to say the least. 

Since I took issue with others’ interpretations on movie runtime data and I have 26K rows of scraped IMDb data sitting in my laptop, I decided to explore the topic myself.

### What I wanted to explore

Movie runtimes, as a topic by itself, feels peripheral.

An increase in runtime among popular movies would merely be a symptom of a deeper, more conscious (and interesting) change in Hollywood. One such change I'll explore is the **[decline of mid-budget movies](https://www.cnn.com/2022/02/26/entertainment/mid-budget-movie-decline-cec/index.html), and mid-budget comedies in particular**. Another recent trend, which is inversely related to the previous, is all the **superhero and I.P.-based Action movies** that have dominated theater screens since the advent of the Marvel Cinematic Universe (MCU). If Comedies are shorter in runtime than Action movies - which they are - then a drop in Comedy and rise in Action among mainstream movies would naturally result in an increase in average runtime. Note that any film production changes from recent years could not have come from a vaccuum; box office successes (and failures) of the past are likely to have informed recent film studio decision-making. 

Of course, I'm also considering the huge role streaming services has played in the types of movies we now see in theaters. 

Keeping all that in mind, I came up with the questions below.

## Questions of Interest

<font size="4">

### 1. Are movies longer now than before? {#q1}
a) Are blockbusters longer now than before? <font size="1"> See [Result](#1a). </font>
b) Are mid-budget movies longer now than before? <font size="1"> See [Result](#1b). </font>
c) Are Action movies longer now than before? <font size="1"> See [Result](#1c). </font>
d) Are non-Action Comedy movies longer now than before? <font size="1"> See [Result](#1d). </font>

### 2. Are longer movie types becoming more common than before, and shorter movie types less common? {#q2}
a) Are Action movies more present among Blockbusters now than before? <font size="1"> See [Result](#2a). </font>
b) are non-Action Comedies less present among Blockbusters now than before? <font size="1"> See [Result](#2b). </font>
c) Are Action movies more present among mid-Budget movies now than before? <font size="1"> See [Result](#2c). </font>
d) are non-Action Comedies less present among mid-Budget movies now than before? <font size="1"> See [Result](#2d). </font>

### 3. Before --- what movies were preferred and how long were they? {#q3}
a) Among top box office performers, Were Action movies more present than non-Action Comedies?  <font size="1"> See [Result](#3a). </font>
b) Among mid box office performers, Were Action movies more present than non-Action Comedies? <font size="1"> See [Result](#3b). </font>
c) Were Action movies longer than non-Action Comedies? <font size="1"> See [Result](#3c). </font>
d) Were the top box office performers longer than the mid box office performers? <font size="1"> See [Result](#3d). </font>

To learn how Blockbusters, Mid-Budget, and the 'Before' and 'Now' time periods were defined, explanation [here](#settingparameters).

</font>



## Results

<font size="4">

* **Blockbuster Movies got 6 minutes longer**: The biggest budget films of each year did get longer, on average, by 6 minutes.   

```{r, echo = FALSE, include = FALSE}
before_year1 <- 2009
before_year2 <- 2015
after_year1 <- 2016
after_year2 <- 2022
ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Budget"
    top_from_ba <- 1
    top_to_ba <- 50
    exclude_years_ba <- 2020
    exclude_genres_ba = "Ignore"
    
filtered_data6 <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)

   original_df <- filtered_data6 %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
    
```



```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the yearly Top 50 Highest Budget films --- 2009-2015 vs 2016-2022 (excluding 2020)") %>% 
  kableExtra::kable_styling()
```

* Mid-Budget Movies barely got longer: These movies saw a slight increase of 2 minutes in average runtime.


<!-- In 2009-2015, The yearly fifty  **highest grossing films were 6 minutes longer than the fifty next-highest grossing movies** , on average. The  **first 50 had more Action**  movies than non-Action Comedies (45% vs 33%) whereas the  **next 50 had fewer Action**  movies than non-Action Comedies. -->

* Current Action vs Comedy trends:
  * **Action**: Studios now make **5% more Blockbuster** and **5% more Mid-Budget** movies that are Action than before (62% vs 57% and 38% vs 33%).
  * **Non-Action Comedy**: Studios now make **7% fewer Blockbuster** and **9% fewer Mid-Budget** movies that are non-Action Comedies than before. This means the Mid-Budget movies went from having as many Action movies as non-Action Comedies in 2009-2015 to having 14% more Action movies than non-Action Comedies in 2016-2022. 
  * **Movie types themselves are getting longer**: Action movies are 6 minutes longer now and non-Action Comedies are 3 minutes longer, on average. 
  
  <!-- **Rise of big Action Movies (and fall of big Non-Action Comedies)**  : More Action movies are among both Blockbusters and Mid-Budget movies now than before (62% vs 57% and 38% vs 33%). Conversely, the non-Action Comedies fell among both budget groups (28% vs 21% and 33% to 24%). This means the Mid-Budget movies went from having as many Action movies as non-Action Comedies in 2009-2015 to having 14% more Action movies than non-Action Comedies in 2016-2022.  -->

```{r, echo = FALSE, include = FALSE}

before_year1 = 2009;
                           before_year2 = 2015;
                            after_year1 = 2016;
                            after_year2 = 2022;

ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Budget"
    top_from_ba <- 51
    top_to_ba <- 100
    exclude_years_ba <- 2020
    exclude_genres_ba <- "Ignore"
    
filtered_data6 <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba, 
    exclude_genres_ba)
    
genre_percentage_ba_input <- c("Comedy")
exclude_genre_percentage_ba_input <- "Action"
  
table_3e <- get_chisq_genres(filtered_data6, genre_percentage_ba_input, exclude_genre_percentage_ba_input)
plot_3e <- get_genres_ba_plot(filtered_data6, genre_percentage_ba_input, exclude_genre_percentage_ba_input)

genre_percentage_ba_input <- c("Action")
  
table_3f <- get_chisq_genres(filtered_data6, genre_percentage_ba_input, "Ignore")
plot_3f <- get_genres_ba_plot(filtered_data6, genre_percentage_ba_input, "Ignore")

# filtered_data6 %>% filter(Group %>% str_detect("Before"), Genres %>% str_detect("Action"))
# filtered_data6 %>% filter(Group %>% str_detect("Before"), Genres %>% str_detect("Action"))
```

```{r, echo=FALSE, figures-side, fig.show="hold", out.width="100%"}
# par(mar = c(4, 4, .1, .1))

# table_3e  %>% kable()
plot_3e <- ggplotly(plot_3e + lims(y = c(0, 40)) + theme(
  # axis.text=element_text(size=20),axis.title=element_text(size=10), 
  legend.position = "top") ,
  showlegend = FALSE)

# table_3f  %>% kable()
plot_3f <- ggplotly(plot_3f + lims(y = c(0, 40)) + theme(
  # axis.text=element_text(size=20),axis.title=element_text(size=10), 
                                                         legend.position = "top"),
  showlegend = TRUE, legend = list(orientation = "h", x = 0, y = 1.05))
# layout(plot_3e)
# layout(plot_3f)
subplot(style(plot_3e, showlegend = FALSE), 
        plot_3f, nrows = 1, margin = 0.04,
        shareX = TRUE,
  shareY = TRUE,
  titleX = TRUE,
  titleY = TRUE) %>% layout(title = "% of Mid-Budget movies that are Comedy and Action")
```
* Past Moviegoer Preferences:
  * **Highest-grossing movies were 6 minutes longer** than the next-highest-grossing movies.
  * **Highest-grossing movies had more Action flicks than non-Action Comedies** (45% vs 33%). 
  * **Next-highest grossing movies had fewer Action flicks than non-Action Comedies** (28% vs 38%).
  
  


</font>

### Dashboard Plug

The results of the analysis are specific to how Blockbuster and Mid-Budget films were defined, and to the time periods used for the 'Before'/'After' analysis. Other approaches to a movie runtime investigation could be perfectly valid, which is why I built a dashboard letting you explore the IMDb movie runtime data how you wish. With the tool, you can see how movie runtime varies over time and by genre or production company. You can specify the time periods for your own 'Before'/'After' analysis, as well as compare two kinds of movies of your choice. You can filter the movies based on genre, release year, budget, box office gross, director and other characteristics. Please note, however, that as in any analysis, the movies you’re including (or excluding) should affect your interpretations accordingly. All the plots and tables in this post were produced using the dashboard, which is linked [here](https://analitty.shinyapps.io/MovieRuntimes/).

### Summary

#### Comedies and Action ficks
They were never the biggest box office performers, but comedies performed nonetheless. They were even more common among mid-budget films than Action movies were. This is no longer the case, as the 2+ hour MCU, DCU, Kong, Jumanji, and all other Action-y franchises became an even bigger part of the recent years’ mainstream films. 

These findings are consistent with the idea that studios are relying on I.P.-based “amusement park” movies to draw us out from our streaming services-infused homes. Streaming services, as [Matt Damon explains](https://virginradio.co.uk/entertainment/133533/matt-damon-blames-streaming-decline-quality-bad-films), also led to the death of DVD sales and rentals, which had provided production companies a considerable extra cushion of revenue. If the convenience of at-home, on-demand entertainment and lack of DVD revenue leads production companies to adopt a “go big or go home” strategy for theater releases, then they might think to double down on a higher grossing movie type, which we saw in 2009-2015 was Action more than Comedy. And since these Action films are generally longer than Comedies, then it makes sense mainstream movies are seeing an increase in runtime. 

In addition, though, Action films themselves are getting longer in runtime - also by a 6 minutes average. One explanation is related to the [second limitation](#gentypes): there are various subtypes of Action movies, so perhaps longer-running subtypes have become more frequent than before, thereby increasing the average runtime for all Action movies. Post-credit scenes, which are now a commonplace element of franchise movies, may also be responsible for a small increase in average runtime.   

<!-- The addition of post-credit scenes in almost every franchise movie now might account for a portion of that increase, but I'm sure there is more at play here.   -->

<!-- Another explanation is given by David T. Friendly in his aforementioned online [plea](https://puck.news/shorter-movies-please/) for shorter movies: streamers, who care more about time spent on their platform than the number of daily showtimes, don't hate extra-long movies like theater owners do.  -->

<!-- One explanation for this is related to the last limitation: Action movies include more than the “amusement park” films, and so the longer average runtime can come from an increased presence of a longer subtype (similar logic as saying mainstream movies are getting longer because more of them are Action now).  -->

<!-- ### Tangent: Streamers are Scary -->
<!-- Clearly, streaming services play a role (both direct and indirect) in what films we get to see within reasonable access, and that’s worrisome!  Netflix’s use of an algorithm to inform its TV programming is scary. It wasn’t scary when Netflix would give artists a platform to make fun, original comedy specials like Chelsea Peretti: One of the Greats, but it *is* scary when Netflix decides to remove one of their very first “Netflix Original” comedy specials, Chelsea Peretti: One of the Greats, from their platform. The special was even wiped from the Netflix stand up specials wikipedia page. https://en.wikipedia.org/wiki/List_of_Netflix_original_stand-up_comedy_specials  -->

### Limitations

#### Generalizing movie types {#gentypes}
My way of defining movie types (Action and Non-Action Comedy) was broad. The comedies considered in our analysis range from slapstick comedies like [Paul Blart: Mall Cop](https://www.imdb.com/title/tt1114740/) to [Oscar-bait comedic dramas](https://www.imdb.com/title/tt6966692/). Surely these are not the same type of movie. Even Action encompasses a variety of films, from [The Angry Birds Movie](https://www.imdb.com/title/tt1985949/) to [Dunkirk](https://www.imdb.com/title/tt5013056/) to [The Angry Birds Movie 2](https://www.imdb.com/title/tt6095472/).

#### Bigger budget does not necessarily mean theatrical release
My assumption that higher budget movies are more likely to play in theaters may not hold for all movies, especially in today’s streaming era. This was made evident by a [Hollywood Reporter article](https://www.hollywoodreporter.com/movies/movie-features/glen-powell-interview-hit-man-movie-texas-move-1235905159/), in which actor Glen Powell is quoted saying he and [Anyone But You (2023)](https://www.imdb.com/title/tt26047818/) co-star and producer Sydney Sweeney turned down bigger budgets from streamers in order to give their romantic comedy a proper theatrical release. 

More limitations are described [here](#fulllimitations).

### Closing Thoughts
#### We used to be a people that watched 100-minute-long Comedies in a Cineplex Odeon theater.
From 2009 to 2015, we had two Grown Ups and three Hangover films grace our cinemas, all of which were between 100 and 102 minutes in runtime, and made \$200 to \$550 million each. The year 2011 saw two Rom Coms called No Strings Attached and Friends with Benefits release in theaters; they shared the same exact premise and yet both grossed a handsome \$150 million worldwide each. Now, Adam Sandler movies go straight to [Netflix](https://www.indiewire.com/features/general/adam-sandler-netflix-deal-extended-four-movies-1202207433/), The Hangover director is onto his second Joker film, and Romantic Comedies… go straight to [Netflix](https://www.imdb.com/title/tt7374948/) (or [Hulu](https://www.imdb.com/title/tt15218000/), [Prime](https://www.imdb.com/title/tt6462958/), and so on). 

#### Can "smaller" movies make a theatrical comeback? 
According to a [survey](https://www.thecinemafoundation.org/wp-content/uploads/2023/03/State-of-the-Cinema-Industry-March-2023.pdf) conducted by The Cinema Foundation, people want to watch more comedies in theaters. Anyone But You's box office success is evidence of this sentiment, and we've since seen [other producers](https://www.worldofreel.com/blog/2024/10/24/wuthering-heights) choose theatrical releases over a big Netflix cheque. Moreover, in his Academy Award acceptance speech for writing [American Fiction](https://www.imdb.com/title/tt23561236/), Cord Jefferson called out studios' blockbuster-obsessed nature and advocated "Instead of making one \$200 million movie, try making 10 \$20 million movies". He was met with applause but who knows how earnest. 

In the meantime, we can still go out and find a [shorter movie to watch in theaters](https://www.imdb.com/search/title/?title_type=feature&release_date=2024-01-01,&runtime=1,100&now_playing=restrict&sort=boxoffice_gross_us,asc), despite it being less common. Who knows, maybe you can watch two since they're so short. 





<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>







## Appendix 

### A1: Defining 'Mainstream', distinguishing between 'Mid-Budget' and 'Blockbuster', and choosing our 'Before' and 'Now' periods {#settingparameters}


###### Mainstream
I’d consider mainstream movies to be the most accessible to the average moviegoer. The IMDb-provided variable that is most related to accessibility (in my opinion) is movie budget. That is, the greater the budget of a movie, the more I'd expect it to be given a wide theatrical release and be part of “the mainstream culture”. Since there are about 100 movies released in theaters per year (according to [statista](https://www.statista.com/statistics/1400581/number-movies-released-theaters-us-canada/)), I define mainstream movies as those among the top 100 budget films of their given release year.  

###### Blockbuster vs Mid-Budget
To obtain an even split from the 100 Mainstream movies, I define the top 50 budget films of each year as Blockbuster films and the next 50 as Mid-Budget films. That is, for every year considered in the analysis, the hundred movies with the highest budgets will be included. Of those hundred, the fifty with the highest budget will be treated as Blockbusters and the remaining fifty will be treated as Mid-Budget.

###### 'Before' and 'Now'
The ‘Before’ period is set to be the years 2009 to 2015. I think these years represent the beginning of the MCU, from their first hits (except Iron Man (2008)) to their first [Avengers](https://www.imdb.com/title/tt0848228/) [films](https://www.imdb.com/title/tt2395427/) (143 and 141 minutes, respectively) in which standalone characters crossed over with each other, grossing billions of dollars and solidifying the 'Universe'. This time also covers Netflix's rise in popularity, and the start of streaming services original programming (which was both [popular](https://www.imdb.com/title/tt1856010/) and [critically acclaimed](https://www.imdb.com/title/tt3502262/)). The ‘Now’ period is 2016 to 2022, with 2020 excluded due to the outlier-like impact COVID-19 had on film that year. This era saw the [peak of the MCU](https://www.imdb.com/title/tt4154796/) (181 minutes), the advent of so many  other [I.P.-based](https://www.imdb.com/title/tt1985949/) [movie](https://www.imdb.com/title/tt3794354/) [universes](https://www.imdb.com/title/tt5034838/), and the ubiquity of streaming services. 


### A2: More Limitations {#fulllimitations}

##### Generalizing Blockbuster and Mid-Budget films
The fifty highest budget and the next fifty highest budget films are grouped as Blockbuster and Mid-Budget films, respectively, even though there could be high variation in budget within the two groups. Second, the variation itself may change over time, meaning the fifty highest budget films could represent a different proportion of Hollywood expenses in 2009 than in 2016. That is, if a movie studio’s strategy changes from making a few midsize movies per year to one huge movie, then perhaps the definition for a Blockbuster should change accordingly and cover fewer movies now than before.

##### No 2023 Data
The most recent data I have is of 2022, meaning I'm missing a full year of the most recent movies (2023). One year doesn't sound so bad, but the analysis is meant to explore a recent trend so it would've been nice to have the most recent data. 


### A3: Results by question

##### 1. Are Movies Getting Longer
###### a) Are blockbusters getting longer? {#1a} 
<font size = "1"> Back to [the questions](#q1). </font>

```{r, echo = FALSE, include = FALSE}
before_year1 <- 2009
before_year2 <- 2015
after_year1 <- 2016
after_year2 <- 2022
ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Budget"
    top_from_ba <- 1
    top_to_ba <- 50
    exclude_years_ba <- 2020
    exclude_genres_ba = "Ignore"
    
filtered_data6 <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)

   original_df <- filtered_data6 %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
    
```



```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the yearly Top 50 Highest Budget films of 2009-2015 vs 2016-2022 (excluding 2020)") %>% 
  kableExtra::kable_styling()
```

###### b) Are mid-budget movies getting longer? {#1b} 
<font size = "1"> Back to [the questions](#q1). </font>

```{r, echo = FALSE, include = FALSE}
before_year1 <- 2009
before_year2 <- 2015
after_year1 <- 2016
after_year2 <- 2022
ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Budget"
    top_from_ba <- 51
    top_to_ba <- 100
    exclude_years_ba <- 2020
    exclude_genres_ba = "Ignore"
    
filtered_data6 <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba)

   original_df <- filtered_data6 %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
    
```




```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the yearly 51st-100th Highest Budget films of 2009-2015 vs 2016-2022 (excluding 2020)") %>%
  kableExtra::kable_styling()
```

###### c) Are Action movies getting longer? {#1c}

<font size = "1"> Back to [the questions](#q1). </font>

```{r, echo = FALSE, include = FALSE}

before_year1 = 2009;
                           before_year2 = 2015;
                            after_year1 = 2016;
                            after_year2 = 2022;

ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "Action"
    the_top_50_ba <- "Budget"
    top_from_ba <- 1
    top_to_ba <- 50
    exclude_years_ba <- 2020
    exclude_genres_ba <- "Ignore"
    
    
filtered_data6_3a <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba = "Ignore")
original_df <- filtered_data6_3a %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
```

```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the top 50 highest budget Action films --- 2009-2015 vs 2016-2022 (excluding 2020)") %>%
  kableExtra::kable_styling()
```

###### d) Are Comedy movies getting longer? {#1d}
<font size = "1"> Back to [the questions](#q1). </font>

```{r, echo = FALSE, include = FALSE}

before_year1 = 2009;
                           before_year2 = 2015;
                            after_year1 = 2016;
                            after_year2 = 2022;

ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "Comedy"
    the_top_50_ba <- "Budget"
    top_from_ba <- 1
    top_to_ba <- 50
    exclude_years_ba <- 2020
    exclude_genres_ba <- "Action"
    
    
filtered_data6_3b <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba,
    exclude_genres_ba = "Action")
original_df <- filtered_data6_3b %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
```

```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the top 50 highest budget non-Action Comedy films --- 2009-2015 vs 2016-2022 (excluding 2020)") %>%
  kableExtra::kable_styling()
```

##### 2. Are longer movie types becoming more common than before, and shorter movie types less common

###### a) Are Action movies more present among Blockbusters now than before? {#2a}
<font size = "1"> Back to [the questions](#q2). </font>

```{r, echo = FALSE, include = FALSE}

before_year1 = 2009;
                           before_year2 = 2015;
                            after_year1 = 2016;
                            after_year2 = 2022;

ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Budget"
    top_from_ba <- 1
    top_to_ba <- 50
    exclude_years_ba <- 2020
    exclude_genres_ba <- "Ignore"
    
filtered_data6 <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba, 
    exclude_genres_ba)
    
genre_percentage_ba_input <- c("Comedy")
 exclude_genre_percentage_ba_input <- c("Action")
 
table_3c <- get_chisq_genres(filtered_data6, genre_percentage_ba_input, exclude_genre_percentage_ba_input)
plot_3c <- get_genres_ba_plot(filtered_data6, genre_percentage_ba_input, exclude_genre_percentage_ba_input)

genre_percentage_ba_input <- c("Action")

table_3d <- get_chisq_genres(filtered_data6, genre_percentage_ba_input, "Ignore")
plot_3d <- get_genres_ba_plot(filtered_data6, genre_percentage_ba_input, "Ignore")

# filtered_data6 %>% filter(Group %>% str_detect("Before"), Genres %>% str_detect("Action"))
# filtered_data6 %>% filter(Group %>% str_detect("After"), Genres %>% str_detect("Action")
#                           # Genres %>% str_detect("Comedy")
#                           ) %>%
#   select(Title, Year, Runtime_numeric)
# 
# filtered_data6 %>% filter(Group %>% str_detect("Before"), Genres %>% str_detect("Romance"),
#                           Genres %>% str_detect("Comedy"))
```

```{r, echo = FALSE}
plot_2a <- ggplotly(plot_3d)

plot_2a
```
###### b) are non-Action Comedies less present among Blockbusters now than before? {#2b}


```{r, echo = FALSE}
plot_2b <- ggplotly(plot_3c)

plot_2b
```

###### d) are non-Action Comedies less present among mid-Budget movies now than before? {#2c}
<font size = "1"> Back to [the questions](#q2). </font>

```{r, echo = FALSE, include = FALSE}

before_year1 = 2009;
                           before_year2 = 2015;
                            after_year1 = 2016;
                            after_year2 = 2022;

ratings_threshold_ba <- 0
    the_bp_oscar_general_ba <- "ignore"
    the_os_oscar_general_ba <- "ignore"
    the_pc_general_ba <- "All"
    the_a_general_ba <- "All"
    the_w_general_ba <- "All"
    the_d_general_ba <- "All"
    the_g_general_ba <- "All"
    the_top_50_ba <- "Budget"
    top_from_ba <- 51
    top_to_ba <- 100
    exclude_years_ba <- 2020
    exclude_genres_ba <- "Ignore"
    
filtered_data6 <- filter_data_ba_fn(before_year1,
                           before_year2,
                            after_year1,
                            after_year2,
                           ratings_threshold_ba, 
                           the_bp_oscar_general_ba, 
                           the_os_oscar_general_ba,
                               the_pc_general_ba,
    the_a_general_ba, 
    the_w_general_ba, 
    the_d_general_ba, 
    the_g_general_ba, 
    the_top_50_ba, 
    top_from_ba,
    top_to_ba,
    exclude_years_ba, 
    exclude_genres_ba)
    
genre_percentage_ba_input <- c("Comedy")
 exclude_genre_percentage_ba_input <- c("Action")
 
table_3c <- get_chisq_genres(filtered_data6, genre_percentage_ba_input, exclude_genre_percentage_ba_input)
plot_3c <- get_genres_ba_plot(filtered_data6, genre_percentage_ba_input, exclude_genre_percentage_ba_input)

genre_percentage_ba_input <- c("Action")

table_3d <- get_chisq_genres(filtered_data6, genre_percentage_ba_input, "Ignore")
plot_3d <- get_genres_ba_plot(filtered_data6, genre_percentage_ba_input, "Ignore")

# filtered_data6 %>% filter(Group %>% str_detect("Before"), Genres %>% str_detect("Action"))
# filtered_data6 %>% filter(Group %>% str_detect("After"), Genres %>% str_detect("Action")
#                           # Genres %>% str_detect("Comedy")
#                           ) %>%
#   select(Title, Year, Runtime_numeric)
# 
# filtered_data6 %>% filter(Group %>% str_detect("Before"), Genres %>% str_detect("Romance"),
#                           Genres %>% str_detect("Comedy"))
```

```{r, echo = FALSE}
plot_2a <- ggplotly(plot_3d)

plot_2a
```

###### d) are non-Action Comedies less present among mid-Budget movies now than before? {#2d}

<font size = "1"> Back to [the questions](#q2). </font>

```{r, echo = FALSE}
plot_2b <- ggplotly(plot_3c)

plot_2b
```

##### 3. Before --- what movies were preferred and how long were they

###### a) Among top box office performers, Were Action movies more present than non-Action Comedies? {#3a}
<font size = "1"> Back to [the questions](#q3). </font>

```{r, echo = FALSE, include=FALSE}

gg_year1 = 2009;
gg_year2 = 2015;
                           ratings_threshold_gg1 = 0; 
                           the_bp_oscar_general_gg1 = "Ignore"; 
                           the_os_oscar_general_gg1 = "Ignore";
                               the_pc_general_gg1 = "All";
    the_a_general_gg1 = "All"; 
    the_w_general_gg1 = "All"; 
    the_d_general_gg1 = "All"; 
    the_g_general_gg1 = "All"; 
    the_top_X_gg1 = "Gross"; 
    topX_from_gg1 = 1;
    topX_to_gg1 = 50;
    exclude_years_gg1 = 2020;
    descriptor_A = "Highest Grossers";
    ratings_threshold_gg2 = "0"; 
                           the_bp_oscar_general_gg2 = "Ignore"; 
                           the_os_oscar_general_gg2 = "Ignore";
                               the_pc_general_gg2 = "All";
    the_a_general_gg2 = "All"; 
    the_w_general_gg2 = "All"; 
    the_d_general_gg2 = "All"; 
    the_g_general_gg2 = "All"; 
    the_top_X_gg2 = "Gross"; 
    topX_from_gg2 = 51;
    topX_to_gg2 = 100;
    exclude_years_gg2 = 2020;
    descriptor_B = "Next-Highest Grossers"

filtered_data_gg <- filter_data_gg_fn(
  gg_year1,
gg_year2,
                           ratings_threshold_gg1, 
                           the_bp_oscar_general_gg1, 
                           the_os_oscar_general_gg1,
                               the_pc_general_gg1,
    the_a_general_gg1, 
    the_w_general_gg1, 
    the_d_general_gg1, 
    the_g_general_gg1, 
    the_top_X_gg1, 
    topX_from_gg1,
    topX_to_gg1,
    exclude_years_gg1,
    exclude_genres_gg1 = "Ignore",
    descriptor_A,
    ratings_threshold_gg2, 
                           the_bp_oscar_general_gg2, 
                           the_os_oscar_general_gg2,
                               the_pc_general_gg2,
    the_a_general_gg2, 
    the_w_general_gg2, 
    the_d_general_gg2, 
    the_g_general_gg2, 
    the_top_X_gg2, 
    topX_from_gg2 ,
    topX_to_gg2 ,
    exclude_years_gg2,
    exclude_genres_gg2 = "Ignore",
    descriptor_B
)

genre_percentage_ba_input <- c("Action")
  
table_2b <- get_chisq_genres_gg(filtered_data_gg, genre_percentage_ba_input, "Ignore")
plot_2b <- get_genres_ba_plot(filtered_data_gg, genre_percentage_ba_input, "Ignore")

genre_percentage_ba_input <- c("Comedy")
exclude_genre_percentage_ba_input <- "Action"
  
table_2c <- get_chisq_genres_gg(filtered_data_gg, genre_percentage_ba_input, exclude_genre_percentage_ba_input)
plot_2c <- get_genres_ba_plot(filtered_data_gg, genre_percentage_ba_input, exclude_genre_percentage_ba_input)

```

```{r, echo = FALSE}
plot_3a <- ggplotly(plot_2b)

plot_3a
```

###### b) Among mid box office performers, Were Action movies more present than non-Action Comedies? {#3b}
<font size = "1"> Back to [the questions](#q3). </font>

```{r, echo = FALSE}
plot_3b <- ggplotly(plot_2c)

plot_3b
```

###### c) Were Action movies longer than non-Action Comedies? {#3c}
<font size = "1"> Back to [the questions](#q3). </font>

```{r, echo = FALSE, include = FALSE}
gg_year1 = 2016;
gg_year2 = 2022;
                           ratings_threshold_gg1 = 0; 
                           the_bp_oscar_general_gg1 = "Ignore"; 
                           the_os_oscar_general_gg1 = "Ignore";
                               the_pc_general_gg1 = "All";
    the_a_general_gg1 = "All"; 
    the_w_general_gg1 = "All"; 
    the_d_general_gg1 = "All"; 
    the_g_general_gg1 = c("Comedy"); 
    the_top_X_gg1 = "Budget"; 
    topX_from_gg1 = 1;
    topX_to_gg1 = 50;
    exclude_years_gg1 = 2020;
    descriptor_A = "Action-less Comedies";
    ratings_threshold_gg2 = "0"; 
                           the_bp_oscar_general_gg2 = "Ignore"; 
                           the_os_oscar_general_gg2 = "Ignore";
                               the_pc_general_gg2 = "All";
    the_a_general_gg2 = "All"; 
    the_w_general_gg2 = "All"; 
    the_d_general_gg2 = "All"; 
    the_g_general_gg2 = c("Action"); 
    the_top_X_gg2 = "Budget"; 
    topX_from_gg2 = 1;
    topX_to_gg2 = 50;
    exclude_years_gg2 = 2020;
    descriptor_B = "Action flicks"
exclude_genres_gg1 = "Action";
exclude_genres_gg2 = "Ignore"

filtered_data_gg <- filter_data_gg_fn(
  gg_year1,
gg_year2,
                           ratings_threshold_gg1, 
                           the_bp_oscar_general_gg1, 
                           the_os_oscar_general_gg1,
                               the_pc_general_gg1,
    the_a_general_gg1, 
    the_w_general_gg1, 
    the_d_general_gg1, 
    the_g_general_gg1, 
    the_top_X_gg1, 
    topX_from_gg1,
    topX_to_gg1,
    exclude_years_gg1,
    exclude_genres_gg1,
    descriptor_A,
    ratings_threshold_gg2, 
                           the_bp_oscar_general_gg2, 
                           the_os_oscar_general_gg2,
                               the_pc_general_gg2,
    the_a_general_gg2, 
    the_w_general_gg2, 
    the_d_general_gg2, 
    the_g_general_gg2, 
    the_top_X_gg2, 
    topX_from_gg2 ,
    topX_to_gg2 ,
    exclude_years_gg2,
    exclude_genres_gg2,
    descriptor_B
)

# genre_percentage_ba_input <- c("Action")

table_2a <- get_ttest_runtimes_gg(filtered_data_gg)
original_df <- filtered_data_gg %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
```

```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the top 50 highest budget Action vs non-Action Comedy films --- 2009-2015") %>%
  kableExtra::kable_styling()
```

###### d) Were the top box office performers longer than the mid box office performers? {#3d}
<font size = "1"> Back to [the questions](#q3). </font>

```{r, echo = FALSE, include = FALSE}
gg_year1 = 2016;
gg_year2 = 2022;
                           ratings_threshold_gg2 = 0; 
                           the_bp_oscar_general_gg2 = "Ignore"; 
                           the_os_oscar_general_gg2 = "Ignore";
                               the_pc_general_gg2 = "All";
    the_a_general_gg2 = "All"; 
    the_w_general_gg2 = "All"; 
    the_d_general_gg2 = "All"; 
    the_g_general_gg2 = "All"; 
    the_top_X_gg2 = "Gross"; 
    topX_from_gg2 = 1;
    topX_to_gg2 = 50;
    exclude_years_gg2 = 2020;
    descriptor_A = "Next-Highest Grossing";
    ratings_threshold_gg1 = "0"; 
                           the_bp_oscar_general_gg1 = "Ignore"; 
                           the_os_oscar_general_gg1 = "Ignore";
                               the_pc_general_gg1 = "All";
    the_a_general_gg1 = "All"; 
    the_w_general_gg1 = "All"; 
    the_d_general_gg1 = "All"; 
    the_g_general_gg1 = "All"; 
    the_top_X_gg1 = "Gross"; 
    topX_from_gg1 = 51;
    topX_to_gg1 = 100;
    exclude_years_gg1 = 2020;
    descriptor_B = "Highest Grossing"

filtered_data_gg <- filter_data_gg_fn(
  gg_year1,
gg_year2,
                           ratings_threshold_gg1, 
                           the_bp_oscar_general_gg1, 
                           the_os_oscar_general_gg1,
                               the_pc_general_gg1,
    the_a_general_gg1, 
    the_w_general_gg1, 
    the_d_general_gg1, 
    the_g_general_gg1, 
    the_top_X_gg1, 
    topX_from_gg1,
    topX_to_gg1,
    exclude_years_gg1,
    exclude_genres_gg1 = "Ignore",
    descriptor_A,
    ratings_threshold_gg2, 
                           the_bp_oscar_general_gg2, 
                           the_os_oscar_general_gg2,
                               the_pc_general_gg2,
    the_a_general_gg2, 
    the_w_general_gg2, 
    the_d_general_gg2, 
    the_g_general_gg2, 
    the_top_X_gg2, 
    topX_from_gg2 ,
    topX_to_gg2 ,
    exclude_years_gg2,
    exclude_genres_gg2 = "Ignore",
    descriptor_B
)

# genre_percentage_ba_input <- c("Action")

original_df <- filtered_data_gg %>% 
      group_by(Group) %>% 
      summarise(n_movies = n(),
                min_runtime = min(Runtime_numeric),
                mean_runtime = round(mean(Runtime_numeric), 1),
                median_runtime = median(Runtime_numeric),
                max_runtime = max(Runtime_numeric))# %>%
      # pivot_longer(-Group,
      #              names_to = "Metric", 
      #              values_to = "Value")
    transposed_df <- t(original_df)  # Exclude the first column (Group) before transposing
    
    # Assigning the row names
    colnames(transposed_df) <- original_df$Group
    
    # transposed_df <- transposed_df[2:nrow(transposed_df),]
    transposed_df <- transposed_df[-1,]
    rownames(transposed_df) <- c("Number of Movies", "Shortest Movie Runtime (mins)", "Mean Movie  Runtime (mins)", "Median Movie Runtime (mins)", "Longest Movie Runtime (mins)")
    transposed_df_1 <- transposed_df %>% as.data.frame()
```

```{r, echo = FALSE}
kable(transposed_df_1, format = "html", table.attr = "style='width:60%;'", caption = "Movie Runtimes of the 1-50 highest grossing vs 51-100 highest grossing films --- 2009-2015") %>%
  kableExtra::kable_styling()
```

